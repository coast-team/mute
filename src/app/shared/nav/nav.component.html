<div class="container" fxLayout="column" fxLayoutAlign="space-between">
  <div fxLayout="column" fxLayoutAlign="start stretch" fxLayoutGap="1.3rem">
    <h1 class="logo">
      <a routerLink="/">MUTE</a>
    </h1>

    <!-- Show new document button with options only if the options are available: -->
    <ng-container *ngIf="environment.botStorage || environment.pulsar; then showMenu; else hideMenu"></ng-container>

    <ng-template #showMenu>
      <button fxFlexAlign="center" class='btn' mat-raised-button color="accent" [matMenuTriggerFor]="newDocMenu">
        New Document
      </button>
      <mat-menu #newDocMenu="matMenu">
        <button mat-menu-item>
          <span class="new-doc-icons">
            <mat-icon>devices</mat-icon>
          </span>
          <span>Without bot storage</span>
        </button>
        <button mat-menu-item (click)="createDocPulsar(true)" *ngIf="environment.pulsar">
          <span class="new-doc-icons">
            <mat-icon>devices</mat-icon>
          </span>
          <span>With Pulsar</span>
        </button>
        <button mat-menu-item (click)="createDoc(true)"
          *ngIf="isRemoteExist && !this.remoteErrorMessage && environment.botStorage">
          <span class="new-doc-icons">
            <mat-icon>devices</mat-icon>
            <mat-icon>cloud</mat-icon>
          </span>
          <span>With bot storage</span>
        </button>
        <button *ngIf="isStandalone" mat-menu-item (click)="openJoinDialog()">
          <span class="new-doc-icons">
            <mat-icon>group_work</mat-icon>
          </span>
          <span>Join</span>
        </button>
      </mat-menu>
    </ng-template>
    <ng-template #hideMenu>
      <button fxFlexAlign="center" class='btn' mat-raised-button color="accent" (click)="createDoc()">
        New Document
      </button>
    </ng-template>

    <div fxLayout="column" fxLayoutAlign="start stretch" class="buttons">

      <!-- Local storage -->
      <button mat-button [disabled]="localErrorMessage" [ngClass]="{'active': selected === local && !localErrorMessage}"
        (click)="openFolder(local)">
        <div fxLayoutAlign="start center">
          <mat-icon
            [color]="selected === local && !localErrorMessage ? 'primary' : ''">{{local.icon}}</mat-icon>{{local.title}}
        </div>
      </button>

      <!-- Trash -->
      <button mat-button [disabled]="localErrorMessage" [ngClass]="{'active': selected === trash && !localErrorMessage}"
        (click)="openFolder(trash)">
        <div fxLayoutAlign="start center">
          <mat-icon
            [color]="selected === trash && !localErrorMessage ? 'primary' : ''">{{trash.icon}}</mat-icon>{{trash.title}}
        </div>
      </button>

      <!-- Local storage quota -->
      <ng-container *ngIf="!localErrorMessage else localDisabled">
        <div *ngIf="isStorageManagerAvailable">
          <div class="mat-caption hint">{{usage | muteSize}} of {{quota | muteSize}} used</div>
        </div>
      </ng-container>
      <ng-template #localDisabled>
        <span *ngIf="localErrorMessage" class="mat-caption hint">{{localErrorMessage}}</span>
      </ng-template>
      <mat-divider></mat-divider>

      <!-- Remote storage -->
      <ng-container *ngIf="isRemoteExist">
        <button mat-button [ngClass]="{'active': selected === remote}" [disabled]="remoteErrorMessage"
          (click)="openFolder(remote)" [matTooltip]="remoteErrorMessage">
          <div fxLayoutAlign="start center">
            <mat-icon [color]="selected === remote ? 'primary' : ''">{{remote.icon}}</mat-icon>{{remote.title}}
          </div>
        </button>

        <mat-divider></mat-divider>
      </ng-container>

      <!-- Settings -->
      <button mat-button (click)="openSettingsDialog()">
        <div fxLayoutAlign="start center">
          <mat-icon>settings</mat-icon>Settings
        </div>
      </button>

    </div>
  </div>


  <div fxLayout="column" fxLayoutAlign="end stretch">
    <button mat-raised-button class="install-update-btns" *ngIf="ui.appUpdate | async" color="warn"
      (click)="update()">Update to v{{(ui.appUpdate | async).version}}</button>
    <button mat-raised-button class="install-update-btns" *ngIf="ui.appInstall | async" color="accent"
      (click)="install()">Add to home screen</button>

    <div fxLayout="column" fxLayoutAlign="end stretch" class="app-info">

      <p>
        <mat-chip-list>
          <!-- TODO: add to libp2p once implemented
          <mat-chip selected *ngIf="environment.">libp2p</mat-chip>
          -->
          <mat-chip selected *ngIf="environment.pulsar">pulsar</mat-chip>
          <mat-chip selected *ngIf="environment.authentication">auth</mat-chip>
        </mat-chip-list>
      </p>
      <ng-container *ngIf="environment.production; then versionInfo"></ng-container>
      <ng-template #versionInfo>
        <p class="mat-caption">Multi-User Text Editor
          <span>
            <a href="https://gitlab.inria.fr/coast-team/mute/mute/-/blob/main/CHANGELOG.md"
              target="_blank">v{{version}}</a>,
          </span>
          <a href="https://gitlab.inria.fr/coast-team/mute/mute" target="_blank">
            <mat-icon aria-label="GitLab repository" fontSet="icon-github-circled"></mat-icon>
          </a>
        </p>
        <p class="mat-caption hint">by
          <a href="https://www.inria.fr/en/teams/coast" target="blank">COAST team</a> | INRIA | LORIA
        </p>
      </ng-template>

    </div>
  </div>
</div>